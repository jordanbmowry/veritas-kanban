# =============================================================================
# Veritas Kanban â€” Docker Compose (Local Testing)
# =============================================================================
# Usage:
#   docker compose up --build        # Build and start
#   docker compose up -d             # Start in background
#   docker compose down              # Stop and remove
#   docker compose logs -f           # Follow logs
# =============================================================================

services:
  veritas-kanban:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: veritas-kanban
    ports:
      - '3001:3001'
    environment:
      - NODE_ENV=production
      - PORT=3001
      - DATA_DIR=/app/data

      # Storage Backend Configuration
      - STORAGE_BACKEND=supabase
      - SUPABASE_URL=${SUPABASE_URL}
      - SUPABASE_ANON_KEY=${SUPABASE_ANON_KEY}

      # Authentication
      - VERITAS_AUTH_ENABLED=true
      - VERITAS_AUTH_LOCALHOST_BYPASS=false
      - VERITAS_ADMIN_KEY=${VERITAS_ADMIN_KEY}
      - VERITAS_JWT_SECRET=${VERITAS_JWT_SECRET}

      # CORS Configuration
      - CORS_ORIGINS=${CORS_ORIGINS:-http://localhost:3001}

      # Optional: Clawdbot Integration
      - CLAWDBOT_GATEWAY=${CLAWDBOT_GATEWAY}

      # Logging
      - LOG_LEVEL=${LOG_LEVEL:-info}
    volumes:
      # Persist task data across container restarts
      - kanban-data:/app/data
    restart: unless-stopped
    healthcheck:
      test: ['CMD', 'wget', '--no-verbose', '--tries=1', '--spider', 'http://localhost:3001/health']
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 10s

volumes:
  kanban-data:
    driver: local
